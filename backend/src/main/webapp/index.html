<!DOCTYPE>
<html>
    <head>
        <title>index</title>
        <link rel="stylesheet" href="bootstrap/css/bootstrap.css" type="text/css"/>
    </head>

<body>
    <div class="container-fluid">
        <div id="userForm" class="row">
            <div class="col-md-4">
                <div class="input-group">
                    <span class="input-group-addon">username:</span>
                    <input v-model="username" type="text" class="form-control">
                    <span class="input-group-addon">password:</span>
                    <input v-model="password" type="password" class="form-control">
                </div>
            </div>
            <div class="col-md-4">
                <button v-on:click="login(username,password)" type="button" class="btn btn-success">login</button>
                {{ loginResult }}
            </div>
        </div>
        <div id="uploadForm" class="row">
            <div class="col-md-4">
                    <div class="input-group">
                        <input id="file" class="form-control" type="file" name="file" />
                        <span class="input-group-addon"><button onclick="uploadFile()" type="button" >submit</button> </span>
                    </div>
            </div>
            <div class="col-md-4">
                <a v-if="uploadResult != null && uploadResult != ''" class="btn btn-link" v-bind:href="downloadLink">{{ uploadResult }}</a>

            </div>
        </div>
    </div>
</body>
    <script type="text/javascript" src="js/fetch.js"></script>
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="js/vue.js"></script>
    <script type="text/javascript" src="bootstrap/js/bootstrap.js"></script>
    <script type="text/javascript" src="js/basePath.js"></script>
    <script type="text/javascript">
        let token = '';
        let user = new Vue({
            el:'#userForm',
            data:{
                username: '',
                password: '',
                loginResult: '',
            },
            methods:{
                login: (username,password) => {
                    fetch(basePath+'/controller/login',{
                        headers:{
                            'Content-Type': 'application/json'
                        },
                        method: 'POST',
                        body:JSON.stringify({
                            username: username,
                            password: password
                        })
                    }).then( response => {
                       return response.text();
                    }).then( text => {
                        user.loginResult = text;
                        if(text){
                            token = text;
                        }
                    });
                }
            }
        });

        let uploadForm = new Vue({
            el: '#uploadForm',
            data: {
                uploadResult: '',
                downloadLink:'',
            }
        });

        function uploadFile(){
            let fileInput = document.getElementById('file');
            let data = new FormData();
            data.append("file",fileInput.files[0]);
            fetch(basePath+'/controller/uploadFile.login',{
                method: 'POST',
                headers: {
                  "login-token":token
                },
                body: data,
            }).then(response => {
                return response.text();
            }).then( text => {
                uploadForm.uploadResult = basePath+text;
                uploadForm.downloadLink = basePath+text;
            });
        }


    </script>
</html>
